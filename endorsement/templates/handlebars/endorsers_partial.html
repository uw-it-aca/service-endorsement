{% load templatetag_handlebars %}

{% tplhandlebars "endorsement_row_partial" %}

<tr class="{{#if is_revoked}}
             unendorsed_service
           {{else}}
             {{#if expiring}}
               expiring_service
             {{else}}
               {{#if endorsement.datetime_endorsed}}
                 endorsed_service
               {{else}}
                 {{#if endorsement.accept_url}}
                   pending_service
                 {{else}}
                   unendorsed_service
                 {{/if}}
               {{/if}}
             {{/if}}
           {{/if}}" data-netid="{{ netid }}"
    data-netid-name="{{ name }}"
    data-netid-initial-email="{{ email }}"
    data-service="{{ svc }}"
    data-service-name="{{ endorsement.category_name }}"
    {{#if type}}data-netid-type="{{ type }}"{{/if}}>

  <td class="endorsed-netid">{{ netid }}</td>

  <td class="endorsed-name">{{ name }}</td>

  <td class="endorsed-aggregate aggregate_action visually-hidden">
    <input type="checkbox" id="aggregate_{{ svc }}_{{ netid }}" value="{{ netid }}" />
  </td>

  <td class="endorsed-service">
    <label for="aggregate_{{ svc }}_{{ netid }}"><span class="significant">{{ endorsement.category_name }}</span></label>
  </td>

  <td class="endorsed-status-icon">
  {{#unless endorsement.is_revoked}}
    {{#if endorsement.datetime_endorsed}}
      {{#if this.expired}}
        <span class="fa fa-exclamation-triangle text-warning"></span>
      {{else}}
        {{#if this.expiring}}
        <span class="fa fa-exclamation-triangle text-warning"></span>
        {{else}}
          <span class="fa fa-check text-success"></span>
        {{/if}}
      {{/if}}
    {{else}}
      {{#if endorsement.accept_id}}
        <span class="fa fa-exclamation-triangle text-warning"></span>
      {{/if}}
    {{/if}}
  {{/unless}}
  </td>

  <td class="endorsed-status">
  {{#if  endorsement.is_revoked}}
    <span class="significant">Not Provisioned</span>
  {{else}}
    {{#if  endorsement.datetime_endorsed}}
      {{#if this.expired}}
        <span class="significant text-danger">Expired</span>
        <br />Expired on {{endorsement.expires}} ({{endorsement.expires_relative}})
      {{else}}
        {{#if this.expiring}}
          <span class="significant text-danger">Expiring</span>
          <br />Expires {{endorsement.expires}} ({{endorsement.expires_relative}})
          <br /><span class="significant">Renewal may be required.</span>
          <br />User may lose access and their files may be deleted.
        {{else}}
          <span class="significant">Provisioned</span>
          <br />Renew by {{endorsement.expires}} ({{endorsement.expires_relative}})
        {{/if}}
      {{/if}}
    {{else}}
      {{#if endorsement.accept_id}}
        <span class="significant">Pending Acceptance</span>
        {{#if endorsement.datetime_emailed}}
        <br />The provisionee has yet to accept the terms and conditions of use. You can resend the acceptance link to the provisionee to complete the provisioning process.
        {{else}}
        <br />The provisionee will be receiving email soon instructing them to confirm the terms and conditions of use.
        {{/if}}
      {{else}}
        <span class="significant">Not Provisioned</span>
      {{/if}}
      {{/if}}
  {{/if}}
  {{#if endorsement.endorsers}}
  <br />{{#if endorsement.datetime_endorsed}}Also{{else}}Already{{/if}} provisioned by <ul class="comma-list">
    {{#each endorsement.endorsers}}
    <li>{{ this }}</li>
    {{/each}}
  </ul>
  {{/if}}
  </td>

  <td class="endorsed-reason">
    {{> reasons_partial endorsement=endorsement}}
  </td>

  <td class="endorsed-action">
  {{#unless endorsement.is_revoked}}  
    {{#if  endorsement.datetime_endorsed}}
      <button type="button" name="Renew {{ endorsement.category_name }}" class="btn btn-primary renew_service renew_{{ svc }}_{{ netid }}" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Renewing">Renew</button>&nbsp;<button type="button" name="Revoke {{ endorsement.category_name }}" class="btn revoke_service revoke_{{ svc }}_{{ netid }}" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Revoking {{ endorsement.category_name }}">Revoke</button>
    {{else}}
      {{#if endorsement.accept_id}}
      <button type="button" class="btn copy_clipboard" data-toggle="tooltip" data-clipboard="{{ endorsement.accept_url }}" data-clipboard-msg="<span class='fa fa-check'></span> Acceptance link copied to clipboard" title="Copy acceptance link to clipboard" href="javascript:void(0);">Copy Link</button>&nbsp;<button type="button" name="Revoke {{ endorsement.category_name }}" class="btn revoke_service revoke_{{ svc }}_{{ netid }}" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Revoking {{ endorsement.category_name }}">Revoke</button>
      {{else}}
        <button type="button" name="Provision service" class="btn endorse_service endorse_{{ svc }}_{{ netid }}" disabled="disabled" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Provisioning">Provision service</button>
      {{/if}}
    {{/if}}
  {{else}}
      <button type="button" name="Provision service" class="btn endorse_service endorse_{{ svc }}_{{ netid }}" disabled="disabled" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Provisioning">Provision service</button>
  {{/unless}}
  </td>
</tr>

{% endtplhandlebars %}
